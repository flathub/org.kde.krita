app-id: org.kde.krita
default-branch: stable
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: krita
rename-icon: krita
finish-args:
  - --share=ipc
  - --share=network
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  - --filesystem=host
  - --filesystem=xdg-run/gvfs
  - --env=PYTHONPATH=/app/lib/python3/dist-packages
  - --env=TMPDIR=/var/tmp
  - --env=QT_QPA_PLATFORMTHEME=gtk3
  - --system-talk-name=org.freedesktop.ColorManager
  - --talk-name=com.canonical.AppMenu.Registrar
cleanup:
  - /doc
  - /include
  - /lib/pkgconfig
  - /lib/cmake
  - /lib/mkspecs
  - /share/aclocal
  - /share/cmake
  - /share/doc
  - /share/pkgconfig
  - /share/info
  - /share/man
  - /cmake
  - '*.a'
  - '*.la'
  - '*.cmake'
  - '*.prl'
cleanup-commands:
  - mkdir -p /app/lib/ffmpeg
add-extensions:
  org.kde.krita.Codecs:
    directory: lib/codecs
    add-ld-path: lib
    bundle: true
    autodelete: true
  org.freedesktop.Platform.ffmpeg-full:
    directory: lib/ffmpeg
    version: '22.08'
    add-ld-path: .
    no-autodownload: true
    autodelete: false
modules:
  - name: qtbase
    build-options:
      arch:
        x86_64:
          config-opts:
            - -reduce-relocations
            - -force-debug-info
        aarch64:
          config-opts:
            - -no-reduce-relocations
            - -opengl es2
    config-opts:
      - -confirm-license
      - -opensource
      - -shared
      - -platform
      - linux-g++
      - -optimized-qmake
      - -nomake
      - examples
      - -nomake
      - tests
      - -system-harfbuzz
      - -system-sqlite
      - -accessibility
      - -dbus-linked
      - -fontconfig
      - -glib
      - -icu
      - -openssl-linked
      - -no-pch
      - -no-rpath
      - -no-directfb
      - -no-linuxfb
      - -no-kms
      - -system-proxies
      - -gtk
      - -no-use-gold-linker
      - -archdatadir
      - /app/lib
    cleanup:
      - /bin
    sources:
      # See link for current Krita Qt fork and git tag https://invent.kde.org/graphics/krita/-/blob/master/3rdparty/ext_qt/CMakeLists.txt
      - type: git
        url: https://invent.kde.org/szaman/qtbase.git
        commit: e075c06efbc1b61bb5e4daec895936530f158ddb
      - type: shell
        commands:
          - mv configure configure.qt
      - type: script
        commands:
          - processed=`sed -e 's/--/-/g ; s/=/ /g' <<< $@`
          - ./configure.qt $processed
        dest-filename: configure
  - name: qtdeclarative
    buildsystem: qmake
    cleanup:
      - /bin
      - /lib/plugins/qmltooling
    sources:
      - type: git
        url: https://invent.kde.org/szaman/qtdeclarative.git
        commit: 967fb735aeb5ef26fb1ccab42bc0720442c14fa2
        disable-shallow-clone: true
        disable-submodules: true
  - name: qtimageformats
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtimageformats.git
        commit: adbc372b890ed90f006a6c4f3ca56bf0cba477ef
  - name: qttools
    buildsystem: qmake
    cleanup:
      - /bin/assistant
      - /bin/qhelpgenerator
      - /bin/qcollectiongenerator
      - /bin/qhelpconverter
      - /bin/pixeltool
      - /bin/designer
      - /bin/lrelease
      - /bin/lupdate
      - /bin/lconvert
      - /bin/linguist
      - /bin/qdoc
      - /bin/qtattributionsscanner
      - /bin/qtplugininfo
      - /bin/qtdiag
      - /bin/qdbusviewer
    sources:
      - type: git
        url: https://invent.kde.org/szaman/qttools.git
        commit: 3cea28be7c7dfe6fd90d3eef88ac6c2307f09051
  - name: qtmultimedia
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtmultimedia.git
        commit: f3dc18968c437c993886d3bfb668b62344a10860
  - name: qtsvg
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtsvg.git
        commit: 83296f10ebdb9a666b11dc69f3a148c38b9c425c
  - name: qtx11extras
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtx11extras.git
        commit: 9134cdba9386e408ce2ffe515ca0c3f6f6c66685
  - name: qttranslations
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qttranslations.git
        commit: c38edd3a5501bcd53132e1e4abb7d25a98e0e1a9
  - name: extra-cmake-modules
    buildsystem: cmake-ninja
    cleanup:
      - '*'
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/extra-cmake-modules-5.105.0.tar.xz
        sha256: 59bbf7ae5f8f2a3addb821c6d9962d3d0f0085f3ccd55f18128763d88e31365b
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/extra-cmake-modules-$version.tar.xz
  - name: kconfig
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kconfig-5.105.0.tar.xz
        sha256: 3e95f516a1e939067550a243a46cc33961d1c9b116330913176e6ea55760e152
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kconfig-$version.tar.xz
  - name: karchive
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/karchive-5.105.0.tar.xz
        sha256: 77ef95cf4c525fe74261c7dd817564a35e726e5c1c4d1e1479fdfec187da9749
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/karchive-$version.tar.xz
  - name: kwidgetsaddons
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kwidgetsaddons-5.105.0.tar.xz
        sha256: adc8c9dedc790b9ee615295c18345efddc66ab0a69d6c0cbcc8bd5df9d6a7f1e
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kwidgetsaddons-$version.tar.xz
  - name: kcompletion
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kcompletion-5.105.0.tar.xz
        sha256: 6e76e822a8b4e49d3357958fd3880858a59ccf4defd45a0e248c57535788b981
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kcompletion-$version.tar.xz
  - name: kcoreaddons
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kcoreaddons-5.105.0.tar.xz
        sha256: 915cd3ac5bb3963fe79a643d70f109a9aa198f97e6a2b5c72f09cd955238daa2
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kcoreaddons-$version.tar.xz
  - name: kguiaddons
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
      - -DWITH_WAYLAND=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kguiaddons-5.105.0.tar.xz
        sha256: 66318ce05ce96fc69533adae525a8aa7e11ee675646fc395b46de30fafa31af1
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kguiaddons-$version.tar.xz
  - name: ki18n
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.104/ki18n-5.104.0.tar.xz
        sha256: fe815b9e28c680fa472c7ab56e4d7934a8915f19409734a13433797a4be14ee1
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/ki18n-$version.tar.xz
  - name: kitemmodels
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kitemmodels-5.105.0.tar.xz
        sha256: d28798439e4f6a1de3388e1fa0b7aefa0002b1902b62841e70551fcba3791523
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kitemmodels-$version.tar.xz
  - name: kitemviews
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kitemviews-5.105.0.tar.xz
        sha256: 25dac0803149156e088b51db1fc717b2c95bf373becc2625b031d0aca06235cd
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kitemviews-$version.tar.xz
  - name: kimageformats
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kimageformats-5.105.0.tar.xz
        sha256: 4ea6ead739f9e850aa8908e246ff2f45f505bbadba20205fb580667bab87d0fc
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kimageformats-$version.tar.xz
  - name: kwindowsystem
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kwindowsystem-5.105.0.tar.xz
        sha256: 40f8032edda348ce2a1ecb5dfe61a8493bec0f68ce93141c3721b72090a6f44a
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kwindowsystem-$version.tar.xz
  - name: kcrash
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/frameworks/5.105/kcrash-5.105.0.tar.xz
        sha256: ee087799922c9a74a7a8f523c75e8af61c27c3ded81b108c51e86faa2921e1c8
        x-checker-data:
          type: anitya
          project-id: 8762
          stable-only: true
          url-template: https://download.kde.org/stable/frameworks/$major.$minor/kcrash-$version.tar.xz
  - name: toml
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        "toml" --no-build-isolation
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/be/ba/1f744cdc819428fc6b5084ec34d9b30660f6f9daaf70eead706e3203ec3c/toml-0.10.2.tar.gz
        sha256: b3bda1d108d5dd99f4a20d24d9c348e91c4db7ab1b749200bded2f839ccbe68f
        x-checker-data:
          type: pypi
          name: toml
  - name: flit_core
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        "flit_core" --no-build-isolation
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/10/e5/be08751d07b30889af130cec20955c987a74380a10058e6e8856e4010afc/flit_core-3.8.0.tar.gz
        sha256: b305b30c99526df5e63d6022dd2310a0a941a187bd3884f4c8ef0418df6c39f3
        x-checker-data:
          type: pypi
          name: flit_core
  - name: pyparsing
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        "pyparsing" --no-build-isolation
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/71/22/207523d16464c40a0310d2d4d8926daffa00ac1f5b1576170a32db749636/pyparsing-3.0.9.tar.gz
        sha256: 2b020ecf7d21b687f219b71ecad3631f644a47f01403fa1d1036b0c6416d70fb
        x-checker-data:
          type: pypi
          name: pyparsing
  - name: packaging
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        "packaging" --no-build-isolation
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/b9/6c/7c6658d258d7971c5eb0d9b69fa9265879ec9a9158031206d47800ae2213/packaging-23.1.tar.gz
        sha256: a392980d2b6cffa644431898be54b0045151319d1e7ec34f0cfed48767dd334f
        x-checker-data:
          type: pypi
          name: packaging
  - name: ply
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        "ply" --no-build-isolation
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e5/69/882ee5c9d017149285cab114ebeab373308ef0f874fcdac9beb90e0ac4da/ply-3.11.tar.gz
        sha256: 00c7c1aaa88358b9c765b6d3000c6eec0ba42abca5351b095321aef446081da3
        x-checker-data:
          type: pypi
          name: ply
  - name: sip
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        "sip" --no-build-isolation
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c7/09/68bfefcdc48875e66aabafc946620483d0cd93aba52dde37d2059e5bf927/sip-6.7.8.tar.gz
        sha256: 7e7186a36818c9d325c82e59ac5b049d9022c2d5783942c38d49497ac8a94c8f
        x-checker-data:
          type: pypi
          name: sip
  - name: pyqt-builder
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        "PyQt-builder" --no-build-isolation
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ee/37/06bc9491c7f84ca776658106a59d3064b1c4c7533a35d547e85fc1e8087f/PyQt-builder-1.15.0.tar.gz
        sha256: a90553703897eb41e27c2f1abd31fb9ed304c32ec3271b380015b54ea9762ddd
        x-checker-data:
          type: pypi
          name: PyQt-builder
  - name: pyqt5_sip
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        "PyQt5_sip" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/2a/f1/dde13ef47f3075737af449bf833ed4d56a16bd1762c66c674c3cceacd973/PyQt5_sip-12.12.0.tar.gz
        sha256: 01bc2d443325505b07d35e4a70d239b4f97b77486e29117fb67f927a15cd8061
        x-checker-data:
          type: pypi
          name: PyQt5_sip
  - name: pyqt5
    buildsystem: simple
    build-commands:
      - sip-install --confirm-license --no-designer-plugin --no-qml-plugin --no-dbus-python
        --no-tools --verbose --target-dir ${FLATPAK_DEST}/lib/python3.10/site-packages
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/5c/46/b4b6eae1e24d9432905ef1d4e7c28b6610e28252527cdc38f2a75997d8b5/PyQt5-5.15.9.tar.gz
        sha256: dc41e8401a90dc3e2b692b411bd5492ab559ae27a27424eed4bd3915564ec4c0
        x-checker-data:
          type: pypi
          name: PyQt5
  - name: fcitx-qt5
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_TESTING=OFF
      - -DENABLE_LIBRARY=OFF
    sources:
      - type: archive
        url: https://github.com/fcitx/fcitx-qt5/archive/refs/tags/1.2.7.tar.gz
        sha256: 4c1c5e4f9c9067f7274a23411599f8510f52d4fa892c87af63466ec806667823
        x-checker-data:
          type: anitya
          project-id: 6513
          stable-only: true
          url-template: https://github.com/fcitx/fcitx-qt5/archive/refs/tags/$version.tar.gz
  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app --with-libraries=system
      - ./b2 variant=release link=shared runtime-link=shared cxxflags="$CXXFLAGS"
        linkflags="$LDFLAGS" -j $FLATPAK_BUILDER_N_JOBS install
    sources:
      - type: archive
        url: https://boostorg.jfrog.io/artifactory/main/release/1.81.0/source/boost_1_81_0.tar.bz2
        sha256: 71feeed900fbccca04a3b4f2f84a7c217186f28a940ed8b7ed4725986baf99fa
        x-checker-data:
          type: anitya
          project-id: 6845
          stable-only: true
          url-template: https://boostorg.jfrog.io/artifactory/main/release/$version/source/boost_${major}_${minor}_${patch}.tar.bz2
  - name: eigen
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_TESTING=OFF
    cleanup:
      - '*'
    sources:
      - type: archive
        url: https://gitlab.com/libeigen/eigen/-/archive/3.4.0/eigen-3.4.0.tar.gz
        sha256: 8586084f71f9bde545ee7fa6d00288b264a2b7ac3607b974e54d13e7162c1c72
        x-checker-data:
          type: anitya
          project-id: 13751
          stable-only: true
          url-template: https://gitlab.com/libeigen/eigen/-/archive/$version/eigen-$version.tar.gz
  - name: exiv2
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMAKE_CXX_STANDARD=14
      - -DEXIV2_BUILD_SAMPLES=OFF
      - -DEXIV2_ENABLE_NLS=OFF
      - -DEXIV2_BUILD_EXIV2_COMMAND=OFF
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/Exiv2/exiv2/releases/download/v0.27.6/exiv2-0.27.6-Source.tar.gz
        sha256: 4c192483a1125dc59a3d70b30d30d32edace9e14adf52802d2f853abf72db8a6
        x-checker-data:
          type: anitya
          project-id: 769
          stable-only: true
          url-template: https://github.com/Exiv2/exiv2/releases/download/v$version/exiv2-$version-Source.tar.gz
  - name: lcms2
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_TESTS=FALSE
      - -DBUILD_UTILS=FALSE
      - -DBUILD_STATIC=FALSE
      - -DBUILD_PLUGINS=TRUE
    cleanup:
      - /bin
      - /share
    sources:
      - type: archive
        url: https://github.com/mm2/Little-CMS/releases/download/lcms2.15/lcms2-2.15.tar.gz
        sha256: b20cbcbd0f503433be2a4e81462106fa61050a35074dc24a4e356792d971ab39
        x-checker-data:
          type: anitya
          project-id: 9815
          stable-only: true
          url-template: https://github.com/mm2/Little-CMS/releases/download/lcms$version/lcms2-$version.tar.gz
      - type: patch
        paths:
          - patches/lcms2/0002-Add-modern-CMake-toolchain.patch
  - shared-modules/glu/glu-9.json
  - shared-modules/glew/glew.json
  - name: freeglut
    buildsystem: cmake-ninja
    build-options:
      cflags: -fcommon
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DFREEGLUT_BUILD_STATIC_LIBS=OFF
    sources:
      - type: archive
        url: https://github.com/FreeGLUTProject/freeglut/releases/download/v3.4.0/freeglut-3.4.0.tar.gz
        sha256: 3c0bcb915d9b180a97edaebd011b7a1de54583a838644dcd42bb0ea0c6f3eaec
        x-checker-data:
          type: anitya
          project-id: 846
          stable-only: true
          url-template: https://github.com/FreeGLUTProject/freeglut/releases/download/v$version/freeglut-$version.tar.gz
  - name: imath
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/AcademySoftwareFoundation/Imath/archive/refs/tags/v3.1.7.tar.gz
        sha256: bff1fa140f4af0e7f02c6cb78d41b9a7d5508e6bcdfda3a583e35460eb6d4b47
        x-checker-data:
          type: anitya
          project-id: 223366
          stable-only: true
          url-template: https://github.com/AcademySoftwareFoundation/Imath/archive/refs/tags/v$version.tar.gz
  - name: pystring
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/imageworks/pystring/archive/281419de2f91f9e0f2df6acddfea3b06a43436be.tar.gz
        sha256: 46161e75f85a3e8867233aebb6f4399f405c565db76dc07731a7ef662459609d
      - type: file
        path: patches/pystring/CMakeLists.txt
  - name: yaml-cpp
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_SHARED_LIBS=ON
      - -DYAML_BUILD_SHARED_LIBS=ON
      - -DYAML_CPP_BUILD_TOOLS=OFF
      - -DYAML_CPP_BUILD_TESTS=OFF
      - -DYAML_CPP_BUILD_CONTRIB=OFF
    sources:
      - type: archive
        url: https://github.com/jbeder/yaml-cpp/archive/refs/tags/yaml-cpp-0.7.0.tar.gz
        sha256: 43e6a9fcb146ad871515f0d0873947e5d497a1c9c60c58cb102a97b47208b7c3
        x-checker-data:
          type: anitya
          project-id: 5284
          stable-only: true
          url-template: https://github.com/jbeder/yaml-cpp/archive/refs/tags/yaml-cpp-$version.tar.gz
  - name: pybind11
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        "pybind11" --no-build-isolation
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/bb/f9/a526ea001ecadd48d90ed7a61038b5ba732136d76b60357d23dc37521c58/pybind11-2.10.4.tar.gz
        sha256: 0bb621d3c45a049aa5923debb87c5c0e2668227905c55ebe8af722608d8ed927
        x-checker-data:
          type: pypi
          name: pybind11
  - name: expat
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/libexpat/libexpat/releases/download/R_2_5_0/expat-2.5.0.tar.gz
        sha256: 6b902ab103843592be5e99504f846ec109c1abb692e85347587f237a4ffa1033
        x-checker-data:
          type: anitya
          project-id: 770
          stable-only: true
          url-template: https://github.com/libexpat/libexpat/releases/download/R_${major}_${minor}_${patch}/expat-$version.tar.gz
  - name: minizip-ng
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_SHARED_LIBS=ON
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/zlib-ng/minizip-ng/archive/refs/tags/3.0.10.tar.gz
        sha256: d4a549731d8c7074e421dbab6d8b8ad0a93067752fe767c464f0f40fa5f0a80d
        x-checker-data:
          type: anitya
          project-id: 301509
          stable-only: true
          url-template: https://github.com/zlib-ng/minizip-ng/archive/refs/tags/$version.tar.gz
  - name: openexr
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DNAMESPACE_VERSIONING=OFF
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/AcademySoftwareFoundation/openexr/archive/refs/tags/v3.1.7.tar.gz
        sha256: 78dbca39115a1c526e6728588753955ee75fa7f5bb1a6e238bed5b6d66f91fd7
        x-checker-data:
          type: anitya
          project-id: 13289
          stable-only: true
          url-template: https://github.com/AcademySoftwareFoundation/openexr/archive/refs/tags/v$version.tar.gz
  - name: opencolorio
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DOCIO_BUILD_NUKE=OFF
      - -DOCIO_BUILD_DOCS=OFF
      - -DOCIO_BUILD_TESTS=OFF
      - -DOCIO_BUILD_GPU_TESTS=OFF
      - -DOCIO_BUILD_PYTHON=OFF
      - -DOCIO_INSTALL_EXT_PACKAGES=NONE
      - -Dminizip-ng_LIBRARY=/app/lib/libminizip.so
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/AcademySoftwareFoundation/OpenColorIO/archive/refs/tags/v2.2.0.tar.gz
        sha256: 81e3b6e0e432d20347b6396c376f9fbeceac31c2cbefe2882d83112a5b0a8123
        # x-checker-data:
        #   type: anitya
        #   project-id: 9631
        #   stable-only: true
        #   url-template: https://github.com/AcademySoftwareFoundation/OpenColorIO/archive/refs/tags/v$version.tar.gz
      - type: patch
        paths:
          - patches/opencolorio/use-system-minizip.patch
  - name: libraw
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    cleanup:
      - /bin
      - /share/doc
    sources:
      - type: archive
        url: https://www.libraw.org/data/LibRaw-0.21.1.tar.gz
        sha256: 630a6bcf5e65d1b1b40cdb8608bdb922316759bfb981c65091fec8682d1543cd
        x-checker-data:
          type: anitya
          project-id: 1709
          stable-only: true
          url-template: https://www.libraw.org/data/LibRaw-$version.tar.gz
      - type: patch
        paths:
          - patches/libraw/0001-LibRaw-cmake.patch
          - patches/libraw/0002-Use-CMake-install-prefix.patch
  - name: gsl
    config-opts:
      - --disable-static
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/gsl/gsl-2.7.1.tar.gz
        sha256: dcb0fbd43048832b757ff9942691a8dd70026d5da0ff85601e52687f6deeb34b
        x-checker-data:
          type: anitya
          project-id: 1267
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/gsl/gsl-$version.tar.gz
  - name: poppler-data
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://poppler.freedesktop.org/poppler-data-0.4.12.tar.gz
        sha256: c835b640a40ce357e1b83666aabd95edffa24ddddd49b8daff63adb851cdab74
        x-checker-data:
          type: anitya
          project-id: 3687
          stable-only: true
          url-template: https://poppler.freedesktop.org/poppler-data-$version.tar.gz
  - name: poppler
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_GTK_TESTS=OFF
      - -DBUILD_QT5_TESTS=FALSE
      - -DBUILD_CPP_TESTS=FALSE
      - -DENABLE_UTILS=FALSE
      - -DENABLE_GLIB=FALSE
      - -DENABLE_LIBOPENJPEG=none
      - -DWITH_NSS3=OFF
    sources:
      - type: archive
        url: https://poppler.freedesktop.org/poppler-23.04.0.tar.xz
        sha256: b6d893dc7dcd4138b9e9df59a13c59695e50e80dc5c2cacee0674670693951a1
        x-checker-data:
          type: anitya
          project-id: 3686
          stable-only: true
          url-template: https://poppler.freedesktop.org/poppler-$version.tar.xz
  - name: quazip
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/stachenov/quazip/archive/refs/tags/v1.4.tar.gz
        sha256: 79633fd3a18e2d11a7d5c40c4c79c1786ba0c74b59ad752e8429746fe1781dd6
        x-checker-data:
          type: anitya
          project-id: 4141
          stable-only: true
          url-template: https://github.com/stachenov/quazip/archive/refs/tags/v$version.tar.gz
  - name: aom
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCONFIG_PIC=1
      - -DBUILD_SHARED_LIBS=OFF
      - -DENABLE_EXAMPLES=OFF
      - -DENABLE_TESTDATA=OFF
      - -DENABLE_TESTS=OFF
      - -DENABLE_TOOLS=OFF
    sources:
      - type: archive
        url: https://storage.googleapis.com/aom-releases/libaom-3.6.0.tar.gz
        sha256: a4a6c0fab685da743b796662a928fcdf7ae60594edc306efb73e78a17ea6cde6
        x-checker-data:
          type: anitya
          project-id: 17628
          stable-only: true
          url-template: https://storage.googleapis.com/aom-releases/libaom-$version.tar.gz
  - name: libx265-10bit
    buildsystem: cmake-ninja
    subdir: source
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DHIGH_BIT_DEPTH=TRUE
      - -DEXPORT_C_API=FALSE
      - -DENABLE_CLI=FALSE
      - -DENABLE_SHARED=FALSE
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/HandBrake/HandBrake-contribs/releases/download/contribs/x265-snapshot-20220709-12716.tar.gz
        sha256: 19ef8b21301f13d795601184884859e9f4a2f87fcda83757bd7dcd588056e926
        x-checker-data:
          type: html
          url: https://invent.kde.org/graphics/krita/-/raw/master/3rdparty/ext_heif/CMakeLists.txt
          version-pattern: x265-snapshot-([\d-]+).tar.gz
          url-template: https://github.com/HandBrake/HandBrake-contribs/releases/download/contribs/x265-snapshot-$version.tar.gz
      - type: patch
        paths:
          - patches/libx265/A01-build-fix.patch
          - patches/libx265/A02-threads-priority.patch
          - patches/libx265/A03-threads-pool-adjustments.patch
          - patches/libx265/A04-64-bit_for_aarch64.patch
          - patches/libx265/A05-disable-scanPosLast-aarch64-asm.patch
          - patches/libx265/A06-common-threading.patch
          - patches/libx265/0001-Silence-nasm-2.15-warnings.patch
          - patches/libx265/0003-Skip-PDB-in-MinGW.patch
    post-install:
      - mv /app/lib/libx265.a /app/lib/libx265_main10.a
  - name: libx265-12bit
    buildsystem: cmake-ninja
    subdir: source
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DHIGH_BIT_DEPTH=TRUE
      - -DMAIN12=TRUE
      - -DEXPORT_C_API=FALSE
      - -DENABLE_CLI=FALSE
      - -DENABLE_SHARED=FALSE
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/HandBrake/HandBrake-contribs/releases/download/contribs/x265-snapshot-20220709-12716.tar.gz
        sha256: 19ef8b21301f13d795601184884859e9f4a2f87fcda83757bd7dcd588056e926
        x-checker-data:
          type: html
          url: https://invent.kde.org/graphics/krita/-/raw/master/3rdparty/ext_heif/CMakeLists.txt
          version-pattern: x265-snapshot-([\d-]+).tar.gz
          url-template: https://github.com/HandBrake/HandBrake-contribs/releases/download/contribs/x265-snapshot-$version.tar.gz
      - type: patch
        paths:
          - patches/libx265/A01-build-fix.patch
          - patches/libx265/A02-threads-priority.patch
          - patches/libx265/A03-threads-pool-adjustments.patch
          - patches/libx265/A04-64-bit_for_aarch64.patch
          - patches/libx265/A05-disable-scanPosLast-aarch64-asm.patch
          - patches/libx265/A06-common-threading.patch
          - patches/libx265/0001-Silence-nasm-2.15-warnings.patch
          - patches/libx265/0003-Skip-PDB-in-MinGW.patch
    post-install:
      - mv /app/lib/libx265.a /app/lib/libx265_main12.a
  - name: libx265
    skip-arches:
      - aarch64
    buildsystem: cmake-ninja
    subdir: source
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DENABLE_SHARED=TRUE
      - -DENABLE_HDR10_PLUS=TRUE
      - -DEXTRA_LIB='x265_main10.a;x265_main12.a'
      - -DEXTRA_LINK_FLAGS=-L.
      - -DLINKED_10BIT=TRUE
      - -DLINKED_12BIT=TRUE
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/HandBrake/HandBrake-contribs/releases/download/contribs/x265-snapshot-20220709-12716.tar.gz
        sha256: 19ef8b21301f13d795601184884859e9f4a2f87fcda83757bd7dcd588056e926
        x-checker-data:
          type: html
          url: https://invent.kde.org/graphics/krita/-/raw/master/3rdparty/ext_heif/CMakeLists.txt
          version-pattern: x265-snapshot-([\d-]+).tar.gz
          url-template: https://github.com/HandBrake/HandBrake-contribs/releases/download/contribs/x265-snapshot-$version.tar.gz
      - type: patch
        paths:
          - patches/libx265/A01-build-fix.patch
          - patches/libx265/A02-threads-priority.patch
          - patches/libx265/A03-threads-pool-adjustments.patch
          - patches/libx265/A04-64-bit_for_aarch64.patch
          - patches/libx265/A05-disable-scanPosLast-aarch64-asm.patch
          - patches/libx265/A06-common-threading.patch
          - patches/libx265/0001-Silence-nasm-2.15-warnings.patch
          - patches/libx265/0003-Skip-PDB-in-MinGW.patch
  - name: libde265
    skip-arches:
      - aarch64
    config-opts:
      - --disable-sherlock265
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/strukturag/libde265/releases/download/v1.0.11/libde265-1.0.11.tar.gz
        sha256: 2f8f12cabbdb15e53532b7c1eb964d4e15d444db1be802505e6ac97a25035bab
        x-checker-data:
          type: anitya
          project-id: 11239
          stable-only: true
          url-template: https://github.com/strukturag/libde265/releases/download/v$version/libde265-$version.tar.gz
      - type: patch
        paths:
          - patches/libde265/0001-Quick-check-for-SSE-support.patch
  - name: libheif
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DWITH_EXAMPLES=OFF
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/strukturag/libheif/releases/download/v1.15.2/libheif-1.15.2.tar.gz
        sha256: 7a4c6077f45180926583e2087571371bdd9cb21b6e6fada85a6fbd544f26a0e2
        x-checker-data:
          type: anitya
          project-id: 64439
          stable-only: true
          url-template: https://github.com/strukturag/libheif/releases/download/v$version/libheif-$version.tar.gz
  - name: kseexpr
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DENABLE_LLVM_BACKEND=OFF
      - -DBUILD_DOC=OFF
      - -DBUILD_TESTS=OFF
      - -DBUILD_UTILS=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/kseexpr/4.0.4/kseexpr-4.0.4.0.tar.gz
        sha256: ea4f6a8e820e6cc12d2a1e6977e96ea5457f37729fe0bc4ee8cc62d4c26c36ae
        x-checker-data:
          type: anitya
          project-id: 288024
          stable-only: true
          url-template: https://download.kde.org/stable/kseexpr/$version0.$version1.$version2/kseexpr-$version.tar.gz
  - name: json-c
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://s3.amazonaws.com/json-c_releases/releases/json-c-0.16.tar.gz
        sha256: 8e45ac8f96ec7791eaf3bb7ee50e9c2100bbbc87b8d0f1d030c5ba8a0288d96b
        x-checker-data:
          type: anitya
          project-id: 1477
          stable-only: true
          url-template: https://s3.amazonaws.com/json-c_releases/releases/json-c-$version.tar.gz
  - name: libmypaint
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/mypaint/libmypaint/releases/download/v1.6.1/libmypaint-1.6.1.tar.xz
        sha256: 741754f293f6b7668f941506da07cd7725629a793108bb31633fb6c3eae5315f
        x-checker-data:
          type: anitya
          project-id: 12974
          stable-only: true
          url-template: https://github.com/mypaint/libmypaint/releases/download/v$version/libmypaint-$version.tar.xz
      - type: patch
        paths:
          - patches/mypaint/0001-Add-cmake-build-system.patch
          - patches/mypaint/0002-cmake-library-versioning-info-for-pkg-config.patch
          - patches/mypaint/0003-cmake-library-versioning-info-for-CMake-itself.patch
          - patches/mypaint/0004-cmake-Fix-relative-paths.patch
          - patches/mypaint/0005-Export-all-symbols.patch
  - name: highway
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_TESTING=OFF
      - -DBUILD_STATIC_LIBS=ON
      - -DBUILD_SHARED_LIBS=OFF
    sources:
      - type: archive
        url: https://github.com/google/highway/archive/refs/tags/1.0.4.tar.gz
        sha256: faccd343935c9e98afd1016e9d20e0b8b89d908508d1af958496f8c2d3004ac2
        x-checker-data:
          type: anitya
          project-id: 205809
          stable-only: true
          url-template: https://github.com/google/highway/archive/refs/tags/$version.tar.gz
  - name: libjxl
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_TESTING=OFF
      - -DJPEGXL_ENABLE_BENCHMARK=OFF
      - -DJPEGXL_ENABLE_COVERAGE=OFF
      - -DJPEGXL_ENABLE_EXAMPLES=OFF
      - -DJPEGXL_ENABLE_FUZZERS=OFF
      - -DJPEGXL_ENABLE_JNI=OFF
      - -DJPEGXL_ENABLE_SJPEG=OFF
      - -DJPEGXL_ENABLE_SKCMS=OFF
      - -DJPEGXL_ENABLE_TOOLS=OFF
      - -DJPEGXL_ENABLE_VIEWERS=OFF
    sources:
      - type: archive
        url: https://github.com/libjxl/libjxl/archive/refs/tags/v0.8.1.tar.gz
        sha256: 60f43921ad3209c9e180563025eda0c0f9b1afac51a2927b9ff59fff3950dc56
        x-checker-data:
          type: anitya
          project-id: 232764
          stable-only: true
          url-template: https://github.com/libjxl/libjxl/archive/refs/tags/v$version.tar.gz
  - name: xsimd
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/xtensor-stack/xsimd/archive/refs/tags/11.0.0.tar.gz
        sha256: 50c31c319c8b36c8946eb954c7cca2e2ece86bf8a66a7ebf321b24cd273e7c47
        x-checker-data:
          type: anitya
          project-id: 138109
          stable-only: true
          url-template: https://github.com/xtensor-stack/xsimd/archive/refs/tags/$version.tar.gz
  - name: ffmpeg
    config-opts:
      - --prefix=/app/lib/codecs
      - --enable-gpl
      - --enable-version3
      - --disable-static
      - --enable-shared
      - --enable-ffprobe
      - --disable-ffplay
      - --disable-doc
      - --disable-avdevice
      - --disable-postproc
      - --enable-libaom
      - --enable-zlib
      - --enable-demuxer=image2
      - --enable-demuxer=image2_alias_pix
      - --enable-demuxer=image2_brender_pix
      # Container Formats
      - --enable-muxer=webm
      - --enable-muxer=matroska
      - --enable-muxer=ogg
      - --enable-muxer=apng
      # Image Formats
      - --enable-libwebp
      - --enable-encoder=png
      - --enable-decoder=png
      - --enable-encoder=apng
      - --enable-decoder=apng
      # Video Codecs
      - --enable-encoder=libaom_av1
      - --enable-libvpx
      - --enable-encoder=libvpx_vp9
      - --enable-encoder=libvpx_vp8
      - --enable-libopenh264
      - --enable-libtheora
      # Audio Codecs
      - --enable-encoder=flac
      - --enable-encoder=aac
      - --enable-libmp3lame
      - --enable-libopus
      - --enable-libvorbis
    cleanup:
      - /share/ffmpeg/examples
    sources:
      - type: archive
        url: https://www.ffmpeg.org/releases/ffmpeg-6.0.tar.xz
        sha256: 57be87c22d9b49c112b6d24bc67d42508660e6b718b3db89c44e47e289137082
        x-checker-data:
          type: anitya
          project-id: 5405
          stable-only: true
          url-template: https://www.ffmpeg.org/releases/ffmpeg-$version.tar.xz
  - name: krita
    buildsystem: cmake-ninja
    builddir: true
    build-options:
      env:
        PYTHONPATH: /app/lib/python3.10/dist-packages
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DDEFINE_NO_DEPRECATED=1
      - -DFOUNDATION_BUILD=1
      - -DHIDE_SAFE_ASSERTS=ON
      - -DBUILD_TESTING=FALSE
      - -DKRITA_ENABLE_PCH=off
      - -DHAVE_MEMORY_LEAK_TRACKER=FALSE
    cleanup:
      - /share/icons/hicolor/1024x1024
      - /share/icons/hicolor/scalable
    sources:
      - type: archive
        url: https://download.kde.org/stable/krita/5.1.5/krita-5.1.5.tar.gz
        sha256: 1c775ebef0f799a9a6b74440c3d906ab913c27541b177ed621704de714e9a4d3
        x-checker-data:
          type: anitya
          project-id: 10918
          stable-only: true
          url-template: https://download.kde.org/stable/krita/$version/krita-$version.tar.gz
      - type: patch
        paths:
          - patches/krita/AppData.patch
  - name: gmic
    buildsystem: cmake-ninja
    subdir: gmic-qt
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DGMIC_QT_HOST=krita-plugin
      - -DENABLE_SYSTEM_GMIC=FALSE
    sources:
      - type: archive
        url: https://files.kde.org/krita/build/dependencies/gmic-3.1.6.1-patched.tar.gz
        sha256: 15e195aa728a5d88d3111a199ec73069d0491804dd49afb49beec3e85e93d994
        x-checker-data:
          type: html
          url: https://invent.kde.org/graphics/krita/-/raw/master/3rdparty_plugins/ext_gmic/CMakeLists.txt
          version-pattern: https://files.kde.org/krita/build/dependencies/gmic-([\d.]+)-patched.tar.gz
          url-template: https://files.kde.org/krita/build/dependencies/gmic-$version-patched.tar.gz
