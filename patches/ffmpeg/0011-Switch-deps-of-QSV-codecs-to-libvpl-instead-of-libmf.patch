From db3aa3fef8046cefef4ebcfa27563e14bb9c23e4 Mon Sep 17 00:00:00 2001
From: Dmitry Kazakov <dimula73@gmail.com>
Date: Thu, 17 Apr 2025 15:22:03 +0200
Subject: [PATCH] Switch deps of QSV codecs to libvpl instead of libmfx

---
 depgraph.py | 24 ++++++++++++------------
 1 file changed, 12 insertions(+), 12 deletions(-)

diff --git a/depgraph.py b/depgraph.py
index 02d300ec04..52a2d56e5d 100644
--- a/depgraph.py
+++ b/depgraph.py
@@ -163,7 +163,7 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
                         'gcrypt',
                         'libm',
                         'libdrm',
-                        'libmfx',
+                        'libvpl',
                         'opencl',
                         'openssl',
                         'user32',
@@ -264,7 +264,7 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
                                           'avutil']},
  'decode_video_example': {'deps': ['avcodec', 'avutil']},
  'deflate_wrapper': {'deps': ['zlib']},
- 'deinterlace_qsv_filter': {'deps': ['libmfx'], 'select': ['qsvvpp']},
+ 'deinterlace_qsv_filter': {'deps': ['libvpl'], 'select': ['qsvvpp']},
  'deinterlace_vaapi_filter': {'deps': ['vaapi']},
  'delogo_filter': {'deps': ['gpl']},
  'demux_decode_example': {'deps': ['avcodec', 'avformat', 'avutil']},
@@ -561,7 +561,7 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
                             'mpegts_demuxer']},
  'hls_muxer': {'select': ['mov_muxer', 'mpegts_muxer']},
  'hqdn3d_filter': {'deps': ['gpl']},
- 'hstack_qsv_filter': {'deps': ['libmfx'], 'select': ['qsvvpp']},
+ 'hstack_qsv_filter': {'deps': ['libvpl'], 'select': ['qsvvpp']},
  'hstack_vaapi_filter': {'deps': ['vaapi_1']},
  'htmlpages': {'deps': ['perl'], 'deps_any': ['makeinfo_html', 'texi2html']},
  'http_protocol': {'select': ['tcp_protocol'], 'suggest': ['zlib']},
@@ -761,7 +761,7 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
  'mjpeg_encoder': {'select': ['jpegtables', 'mpegvideoenc']},
  'mjpeg_nvdec_hwaccel': {'deps': ['nvdec'], 'select': ['mjpeg_decoder']},
  'mjpeg_qsv_decoder': {'select': ['qsvdec']},
- 'mjpeg_qsv_encoder': {'deps': ['libmfx'], 'select': ['qsvenc']},
+ 'mjpeg_qsv_encoder': {'deps': ['libvpl'], 'select': ['qsvenc']},
  'mjpeg_vaapi_encoder': {'deps': ['vaencpictureparameterbufferjpeg'],
                          'select': ['cbs_jpeg', 'jpegtables', 'vaapi_encode']},
  'mjpeg_vaapi_hwaccel': {'deps': ['vaapi'], 'select': ['mjpeg_decoder']},
@@ -931,7 +931,7 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
  'overlay_cuda_filter': {'deps': ['ffnvcodec'],
                          'deps_any': ['cuda_nvcc', 'cuda_llvm']},
  'overlay_opencl_filter': {'deps': ['opencl']},
- 'overlay_qsv_filter': {'deps': ['libmfx'], 'select': ['qsvvpp']},
+ 'overlay_qsv_filter': {'deps': ['libvpl'], 'select': ['qsvvpp']},
  'overlay_vaapi_filter': {'deps': ['vaapi', 'vaprocpipelinecaps_blend_flags']},
  'overlay_vulkan_filter': {'deps': ['vulkan', 'spirv_compiler']},
  'owdenoise_filter': {'deps': ['gpl']},
@@ -977,10 +977,10 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
  'qdmc_at_decoder': {'deps': ['audiotoolbox']},
  'qrencode_filter': {'deps': ['libqrencode']},
  'qrencodesrc_filter': {'deps': ['libqrencode']},
- 'qsv': {'deps': ['libmfx']},
+ 'qsv': {'deps': ['libvpl']},
  'qsv_decode_example': {'deps': ['avcodec',
                                  'avutil',
-                                 'libmfx',
+                                 'libvpl',
                                  'h264_qsv_decoder']},
  'qsv_transcode_example': {'deps': ['avcodec',
                                     'avformat',
@@ -1057,7 +1057,7 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
                        'deps_any': ['cuda_nvcc', 'cuda_llvm']},
  'scale_filter': {'deps': ['swscale']},
  'scale_npp_filter': {'deps': ['ffnvcodec', 'libnpp']},
- 'scale_qsv_filter': {'deps': ['libmfx'], 'select': ['qsvvpp']},
+ 'scale_qsv_filter': {'deps': ['libvpl'], 'select': ['qsvvpp']},
  'scale_vaapi_filter': {'deps': ['vaapi']},
  'scale_video_example': {'deps': ['avutil', 'swscale']},
  'scale_vt_filter': {'deps': ['videotoolbox', 'vtpixeltransfersessioncreate']},
@@ -1288,7 +1288,7 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
  'vp9_metadata_bsf': {'select': ['cbs_vp9']},
  'vp9_nvdec_hwaccel': {'deps': ['nvdec'], 'select': ['vp9_decoder']},
  'vp9_qsv_decoder': {'select': ['qsvdec']},
- 'vp9_qsv_encoder': {'deps': ['libmfx', 'mfx_codec_vp9'], 'select': ['qsvenc']},
+ 'vp9_qsv_encoder': {'deps': ['libvpl', 'mfx_codec_vp9'], 'select': ['qsvenc']},
  'vp9_rkmpp_decoder': {'deps': ['rkmpp']},
  'vp9_v4l2m2m_decoder': {'deps': ['v4l2_m2m', 'vp9_v4l2_m2m']},
  'vp9_vaapi_encoder': {'deps': ['vaencpictureparameterbuffervp9'],
@@ -1300,8 +1300,8 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
                        'select': ['vp9_decoder']},
  'vp9_videotoolbox_hwaccel': {'deps': ['videotoolbox'],
                               'select': ['vp9_decoder']},
- 'vpp_qsv_filter': {'deps': ['libmfx'], 'select': ['qsvvpp']},
- 'vstack_qsv_filter': {'deps': ['libmfx'], 'select': ['qsvvpp']},
+ 'vpp_qsv_filter': {'deps': ['libvpl'], 'select': ['qsvvpp']},
+ 'vstack_qsv_filter': {'deps': ['libvpl'], 'select': ['qsvvpp']},
  'vstack_vaapi_filter': {'deps': ['vaapi_1']},
  'vsx': {'deps': ['altivec']},
  'vulkan': {'deps': ['threads'], 'deps_any': ['libdl', 'loadlibrary']},
@@ -1357,7 +1357,7 @@ GRAPH = {'aac_adtstoasc_bsf': {'select': ['adts_header', 'mpeg4audio']},
  'xma2_decoder': {'select': ['wmapro_decoder']},
  'xmv_demuxer': {'select': ['riffdec']},
  'xop': {'deps': ['avx']},
- 'xstack_qsv_filter': {'deps': ['libmfx'], 'select': ['qsvvpp']},
+ 'xstack_qsv_filter': {'deps': ['libvpl'], 'select': ['qsvvpp']},
  'xstack_vaapi_filter': {'deps': ['vaapi_1']},
  'xv_outdev': {'deps': ['xlib_xv', 'xlib_x11', 'xlib_xext']},
  'xwma_demuxer': {'select': ['riffdec']},
-- 
2.25.1
